[ [Intro](README.md) ] -- [ [Preparations](raspibolt_10_preparations.md) ] -- [ [Raspberry Pi](raspibolt_20_pi.md) ] -- [ [Bitcoin](raspibolt_30_bitcoin.md) ] -- [ [Lightning](raspibolt_40_lnd.md) ] -- [ [Mainnet](raspibolt_50_mainnet.md) ] -- [ [**Bonus**](raspibolt_60_bonus.md) ] -- [ [FAQ](raspibolt_faq.md) ] -- [ [Updates](raspibolt_updates.md) ]

------

### Beginner’s Guide to ️⚡Lightning️⚡ on a Raspberry Pi

------

## Bonus guide: Lightning web interface
*Difficulty: medium*

### Introduction

Having a personal full node is great, but the command line interface is just not for everyday usage. At the end of the day the RaspiBolt is a backend that enables additional applications to run without a 3rd party. In my opinion these are the most important components that exist today:

* Desktop wallet with hardware wallet integration for on-chain transactions: [Electrum Personal Server](https://github.com/Stadicus/guides/blob/master/raspibolt/raspibolt_64_electrum.md)
* Web interface for Lightning for desktop / mobile usage: <u>Lnd Web Client</u> (this guide)
* Mobile wallet for Lightning payments on the go: [Shango wallet](https://github.com/Stadicus/guides/blob/master/raspibolt/raspibolt_68_shango.md)

It would be great to have combined Bitcoin on-chain / Lightning wallets both for desktop and mobile usage. Rumors are that Electrum is working on it, and who knows, maybe Samourai will enable complete full node integration soon?

### Lnd Web Client

There are already several web interfaces available for LND. At the moment, the **[Lnd Web Client](https://github.com/mably/lncli-web/blob/master/README.md)** by François Masurel ([mably](https://keybase.io/mably)) seems a good choice, but it's still early days. 

![](images/60_lncliweb_gui.png)



Starting as the "admin" user, we add the new user "web", install Node.js, create new certificates, get the interface running and automate the startup.

#### Install Node.js

Installation and update of Node.js as described on [nodejs.org](https://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions).

```
$ curl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash -
$ sudo apt-get install nodejs
$ sudo npm i npm@latest -g
```

#### Get Lnd Web Client

Add new user and download the source code

```
$ sudo adduser web
$ sudo su web
$ cd
$ git clone https://github.com/mably/lncli-web.git
$ cd lncli-web
$ npm install
$ npm audit fix
$ exit
```

#### Create new certificates

Unfortunately, LND autogenerated certificates are not compatible with the current NodeJS gRPC module implementation. We therefore need to generate new certificates.

```
$ sudo su bitcoin
$ cd ~/.lnd
$ openssl ecparam -genkey -name prime256v1 -out tls.key
$ openssl req -new -sha256 -key tls.key -out csr.csr -subj '/CN=localhost/O=lnd'
$ openssl req -x509 -sha256 -days 36500 -key tls.key -in csr.csr -out tls.cert
$ rm csr.csr
$ exit
```

:warning: Please be aware that these certificates do not take the LND options `tlsextraip` and `tlsextradomain` into account. **These certificates do not allow remote access** with `lncli` or Shango mobile wallet. I will provide additional details how to create compatible certificates.

Now, the new certificates need to be distributed and LND is restarted.

```
# existing users
$ sudo cp /home/bitcoin/.lnd/tls.cert /home/admin/.lnd
$ sudo cp /home/bitcoin/.lnd/tls.cert /home/web/.lnd

# for the new web interface
$ sudo cp /home/bitcoin/.lnd/tls.cert /home/web/lncli-web/lnd.cert
$ sudo cp /home/bitcoin/.lnd/admin.macaroon /home/web/lncli-web/
$ sudo chown web:web /home/web/lncli-web/*

# restart lnd, unlock the wallet and check the startup process
$ sudo systemctl restart lnd
$ lncli unlock
$ sudo journalctl -u lnd -f

# wait a bit and check lncli. If this works, the new certificates are ok:
$ lncli getinfo
```

#### Start Lnd Web Client

We configure the firewall for local network access only, generate self signed SSL certificates and start the web interface manually to test it. See [my comments in the original setup](https://github.com/Stadicus/guides/blob/master/raspibolt/raspibolt_20_pi.md#enabling-the-uncomplicated-firewall) on how you may need to adjust the ip subnet mask.

```
# still as "admin" user
$ sudo ufw allow from 192.168.0.0/24 to any port 8280 comment 'allow WebGUI from local network'
$ sudo ufw enable
$ sudo ufw status

# now as "web" user
$ sudo su web
$ cd ~/lncli-web/

# generate self-signed SSL certificate
$ openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 36500
$ openssl rsa -in key.pem -out newkey.pem && mv newkey.pem key.pem

# start Lnd Web Client (change passwords!)
$ node server --usetls . --serverhost 0.0.0.0 --user manager --pwd YourOwnPassword --limituser lnd --limitpwd YourOwnPassword
```

#### Connect to Lnd Web Client

You now have a webserver running on your RaspiBolt and should be able to open the web application in a web browser on your regular computer (ajust the ip address):

https://192.168.0.20:8280/

:information_source: You probably get a warning as the SSL certificate is not signed by a trusted certificate authority. You can safely ignore this message (and maybe add permanent exception rule, depending on your browser).

There are two users:

* Standard user: can manage everything
* Limited user: has limited functionality, eg. no possibility to make payments

Make sure to test thoroughly before we proceed to automate the startup process.

#### Automate startup 

:warning: **This startup process does not work yet**. Maybe my configuration is not correct or it may be a bug in lncli-web. Related github [issue #153](https://github.com/mably/lncli-web/issues/153).

* Create a new systemd unit for Lnd Web Client that is executed on startup. Copy and paste the following text block into the new file.  
  `$ sudo nano /etc/systemd/system/lncli-web.service` 

```
# RaspiBolt LND Mainnet: systemd unit for lncli-web
# /etc/systemd/system/lncli-web.service

[Unit]
Description=Lnd Web Client
Requires=lnd.service

[Service]
User=web
Group=web
ExecStart=/usr/bin/node /home/web/lncli-web/server.js --usetls /home/web/lncli-web --serverhost 0.0.0.0 --user manager --pwd YourOwnPW --limituser lnd --limitpwd YourOwnPW
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

* Make sure to **use your own passwords**! Save and exit.
* Enable the configuration file  
   `$ sudo systemctl enable lncli-web`



------

<< Back: [Bonus guides](raspibolt_60_bonus.md) 
